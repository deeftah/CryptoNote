<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-right-animation.html">


<dom-module id="reqerr-panel">
<template>
	<style is="custom-style" include="iron-flex iron-flex-alignment">
		paper-dialog.size-position-right-panel { margin:0 !important;
			position:fixed; top:0; right:0; height:100vh; width:40%; min-width:300px; overflow:hidden;}
	</style>
    <style>
	  	:host { margin:0; padding:0; }
	  	:host .top { height:100vh; overflow:hidden; margin:0 !important; padding:0 !important; }
	  	:host .bar { padding:0.5rem 1rem; margin:0; background-color:white; @apply --cf-bold; font-size:1.2rem;
			color:var(--paper-orange-900); border-bottom: 2px solid var(--paper-orange-900);
		}	
	  	:host .body { overflow-y:auto; @apply --std-reg;}
	</style>
	<paper-dialog id="panel" class="size-position-right-panel" modal entry-animation="slide-from-right-animation" exit-animation="slide-right-animation">
	<div class="top layout vertical flex-start">
		<div class="bar">
			<button on-tap="onRetry">[[lib('er_retry',lang)]]</button>
			<button on-tap="onReturnToApp">[[lib('er_resume',lang)]]</button>
			<button on-tap="onReload">[[lib('er_reload',lang)]]</button>
			<button on-tap="onBye">[[lib('er_quit',lang)]]</button>
		</div>
		<div class="body layout vertical flex flex-start">
			<div>Code : [[err.code]]</div>
			<div>Phase : [[err.phase]]</div>
			<div>Message : [[err.message]]</div>
			<template is="dom-repeat" items="[[err.detail]]">
		        <div><i>[[item]]</i></div>
	     	</template>
     	</div>
	</div>
	</paper-dialog>
</template>
<script>
	class ReqerrPanel extends Polymer.Element {
		static get is() { return "reqerr-panel"; }
      
		static get properties() { return {
        	  lang:{type:String, value:App.lang},
        	  err:{type:Object, value:{code:"LX"}},
        	  topInfo:{type:String, value:"?"},
          };
		}
		
		constructor() {
			super();
			App.setMsg("fr", "er_retry", "Ré-essayer");
			App.setMsg("fr", "er_resume", "Renoncer à l'opération");
			App.setMsg("fr", "er_reload", "Recharger l'application");
			App.setMsg("fr", "er_quit", "Quitter l'application");
		}

		lib(code, lang) { 
			return App.lib(code);
		}

		open(request, err) {
			this.request = request;
			this.err = err;
			this.$.panel.open();
			// TODO pretty display de err
		}
		
		onRetry() {
			this.close();
			if (this.request && this.request.onRetry) this.request.onRetry();
		}
		
		onReturnToApp() {
			this.close();
			if (this.request && this.request.onReturnToApp) this.request.onReturnToApp(this.err);		
		}
		
		onBye() {
			this.close();
			App.Util.bye();
		}

		onReload() {
			this.close();
			App.Util.reload();
		}

		close() { this.$.panel.close(); }
		
	}
	customElements.define(ReqerrPanel.is, ReqerrPanel);
</script>
</dom-module>