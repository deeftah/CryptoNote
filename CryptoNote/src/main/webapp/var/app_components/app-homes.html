<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-styles/color.html">

<link rel="import" href="confirm-box.html">
<link rel="import" href="message-box.html">
<link rel="import" href="spinner-box.html">
<link rel="import" href="reqerr-panel.html">
<link rel="import" href="scripterr-panel.html">
<link rel="import" href="help-panel.html">
<link rel="import" href="home1-home.html">
<link rel="import" href="home2-home.html">
<link rel="import" href="wait-home.html">

<dom-module id="app-homes">
<template>
	<style>
	  	:host { margin:0; padding:0;}
	  	:host .top { margin:0; padding:0; height: 100vh; width: 100vw; position:relative; }
  	</style>
	<div class="top">
		<confirm-box id="confirm"></confirm-box>
		<message-box id="message"></message-box>
		<spinner-box id="spin"></spinner-box>
		<reqerr-panel id="reqerr" lang="[[lang]]"></reqerr-panel>
		<scripterr-panel id="scripterr" lang="[[lang]]"></scripterr-panel>
		<help-panel id="help" lang="[[lang]]"></help-panel>
		<iron-pages class="top" attr-for-selected="id" selected="[[home]]">
			<home1-home id="home1" lang="[[lang]]" owner="Scott"></home1-home>
			<home2-home id="home2" lang="[[lang]]"></home2-home>
			<wait-home id="wait" lang="[[lang]]"></wait-home>
		</iron-pages>
	</div>
</template>
<script>
    class AppHomes extends Polymer.Element {
		static get is() { return "app-homes"; }
		static get properties() { return { home: {String, value:"wait"}, lang:{type:String, value:App.lang} } ; }
      	constructor() { 
      		super(); 
      	}
      	ready() {
      		super.ready();
      		App.confirmBox = this.$.confirm;
      		App.messageBox = this.$.message;
      		App.globalSpinner = this.$.spin;
      		App.globalReqErr = this.$.reqerr;
      		App.scriptErrPanel = this.$.scripterr;
      		App.helpPanel = this.$.help;
      		App.appHomes = this;
      		if (App.rootcomplete)
      			this.starting();
      	}
      	async starting() {
      		this.setTheme(App.theme);
  			if (App.Custom && App.Custom.ready)
  				await App.Custom.ready();
  			this.setHome(App.home);
      	}
      	setHome(home) {
      		this.home = home;
      		if (this.$[home].init)
      			this.$[home].init();
      	}
      	setLang(lang) { 
      		App.lang = lang;
      		this.setTheme(App.theme);
      	}
      	setTheme(theme) {
      		App.theme = theme;
      		const sty = {};
      		let t = App.customThemes["z"];
      		if (t) for(let k in t) sty[k] = t[k];
      		t = App.customThemes[theme];
      		if (t) for(let k in t) sty[k] = t[k];
      		t = App.customThemes[App.lang];
      		if (t) for(let k in t) sty[k] = t[k];
      		Polymer.updateStyles(sty);
      		this.lang = App.lang;
      	}
    }
	customElements.define(AppHomes.is, AppHomes);
</script>
</dom-module>
