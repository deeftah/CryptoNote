<link rel="import"  href="../bower_components/paper-input/paper-input.html">
<link rel="import"  href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" 	href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" 	href="../bower_components/paper-input/paper-input.html">
<link rel="import" 	href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import"  href="spinner-box.html">
<link rel="import"  href="help-button.html">

<dom-module id="home2-home">
<template>
<style include="shared-styles"></style>
<style>
	  	:host { font-family: var(--font-std); }
	  	:host .cf {@apply --cf-lite; font-size:1.2rem; color:var(--mybg-color);}
	  	:host .cf::before { content: var(--bonjour-before);}
	  	:host .ic1 {height:3rem; width:3rem; color:red; }
	  	:host .logolang { @apply --flag-gen; width:3rem; height: 3rem; display:inline-block; background-image:var(--bg-imglg);}
</style>
<div class="cf">[[bonjour]] <b>[[owner]] [[build]]</b> [[lib('application',lang)]] [[lib('ns_test',lang)]]</div>
<div>
	<help-button help="p12"></help-button><help-button help="p13" iv="true"></help-button>
</div>
 <div>
 	<paper-input always-float-label label="My floating label" value="{{owner}}">
		<iron-icon class="ic1" icon="mail" slot="prefix"></iron-icon>
		<div slot="suffix">@email.com</div>
		<paper-icon-button slot="suffix" onclick="clearInput()" icon="clear" alt="clear" title="clear"></paper-icon-button>
	</paper-input>
</div>
<div style="position:relative;display:inline-block;">
	<spinner-box id="spin"></spinner-box>
	<div>
		<div class="logolang"></div>
		<iron-icon icon="mail"></iron-icon>
	  	<button on-tap="ping">Ping</button>&nbsp;
	  	<button on-tap="confirm1">confirm 1</button>&nbsp;
	  	<button on-tap="confirm2">confirm 2</button>&nbsp;<br>
	    <button on-tap="changeThemeA">Theme A</button>
	    <button on-tap="changeThemeB">Theme B</button>
	    <button on-tap="changeLangFR">Lang FR</button>
	    <button on-tap="changeLangEN">Lang EN</button><br>
	   	<button on-tap="crypto">crypto</button><br>
	  	<button on-tap="bower">bower.json (fetch)</button><span>[[pingres]]</span>&nbsp;
	  	<button on-tap="checkSrvVersion">Check Version</button>
	</div>
	<a href="bower.json" target="_blank">Lien _blank (relatif) vers bower.json!</a><br>
	<a href="[[lkbower]]" target="_blank">Lien _blank (absolu) vers bower.json!</a><br>
</div>
</template>
<script>
class Home2Home extends Polymer.Element {
	static get is() { return "home2-home"; }
      
	static get properties() {
		return {
			lang:{type:String, value:App.lang},
            owner: {type:String, value:'Daniel' },
        	build: {type:Number, value:App.build},
        	lkbower: {type:String, value:App.baseUrl(1) + "bower.json"},
        	lkping: {type:String, value:App.baseUrl() + "ping"}
		};
	}
	
    constructor() {
        super();
        this.bonjour = App.bonjour ? App.bonjour : "Salut" ;
	}

	lib(code, lang) { return App.lib(code);}

	confirm2() {
		App.confirmBox.show("Ceci est un beau message.", "OK", "Bullshit")
		.then(() => {
			console.log("Confirm OK");
		}).catch(() => {
			console.log("Confirm KO");    		  
		})
	}
	
	confirm1() {
		App.confirmBox.show("Ceci est un TRES beau message.", "Lu")
		.then(() => {
			console.log("Confirm Lu");
		}).catch(() => {
			console.log("Confirm KO2");    		  
		})
	}
	
	changeThemeA() { App.appHomes.setTheme("a"); }
    changeThemeB() { App.appHomes.setTheme("b"); }
	changeLangFR() { App.appHomes.setLang("fr"); }
    changeLangEN() { App.appHomes.setLang("en"); }

    async bower() {
		try {
			let r = await fetch("bower.json");
			if (r.ok) {
				let t = await r.text();
				this.pingres = t.substring(0, 30);
			}
		} catch(e) {
			console.log(e.message);
		}
	}
    
	ping() {
		const spin = this.$.spin;
		// const spin = App.globalSpinner;
		spin.start(this, "hello !");
		setTimeout(() => {
			spin.progress("Traitement du serveur");
			setTimeout(() => {
				App.Util.ping().then(r => {
					this.pingres = !r ? "Erreur" : JSON.stringify(r);
					spin.stop();
        	  	}).catch(err => {
        		  	spin.stop();            		  
        	  	});        		  
			}, 2000);    		  
		}, 2000);
	}
	
	kill() { console.log("kill"); }
	
	checkSrvVersion() {
		App.Util.checkSrvVersion();
	}
	
	async crypto() {
		let x = await App.Util.sha256("toto");
		console.log(App.B64.encode(x, true));
		let y = App.Util.string2bytes("toto");
		x = await App.Util.sha256(y);
		console.log(App.B64.encode(x, true));
		
	}
	
}
customElements.define(Home2Home.is, Home2Home);
</script>

</dom-module>